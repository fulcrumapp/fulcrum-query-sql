{"version":3,"sources":["../src/form-field-schema.js"],"names":["FormFieldSchema","fullSchema","addSystemColumn","label","attribute","columnName","type","accessor","join","sql","column","SimpleColumn","name","attributeName","index","_columns","length","push","_columnsByKey","id","addElementColumn","element","part","columnKey","key","rawColumn","_rawColumnsByKey","addRawElementColumn","columnObject","ElementColumn","setupElementColumns","elementsForColumns","isRepeatableElement","isAddressElement","isPhotoElement","isVideoElement","isAudioElement","isSignatureElement","findColumnByID","columns","find","e","columnForFieldKey","fieldKey","filter","c","isGeometry","_allElements","container","flattenElements","_elementsForColumns","elements","allElements","skip","isSectionElement","isLabelElement"],"mappings":"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","sourcesContent":["import ElementColumn from './schema/element-column';\nimport SimpleColumn from './schema/simple-column';\n\nexport default class FormFieldSchema {\n  constructor({fullSchema = false}) {\n    this.fullSchema = fullSchema;\n  }\n\n  addSystemColumn(label, attribute, columnName, type, accessor, join, sql) {\n    const column = new SimpleColumn({name: label,\n                                     attributeName: attribute,\n                                     columnName: columnName,\n                                     type: type,\n                                     accessor: accessor,\n                                     join,\n                                     sql,\n                                     index: this._columns.length});\n    this._columns.push(column);\n    this._columnsByKey[column.id] = column;\n\n    return column;\n  }\n\n  addElementColumn(element, part, type) {\n    const columnKey = part ? element.key + '_' + part : element.key;\n\n    const rawColumn = this._rawColumnsByKey[columnKey];\n\n    // if (column == null) {\n    //   if the column is null, that means it's a materialized column\n    //   throw new Error('Column not found for element ' + columnKey + Object.keys(this._rawColumnsByKey));\n    // }\n\n    return this.addRawElementColumn(element, rawColumn, null, type || rawColumn.type, part, columnKey);\n  }\n\n  addRawElementColumn(element, rawColumn, id, type, part, columnKey) {\n    const columnObject = new ElementColumn({element, rawColumn, type, id, part, index: this._columns.length});\n\n    this._columns.push(columnObject);\n    this._columnsByKey[columnKey] = columnObject;\n\n    return columnObject;\n  }\n\n  setupElementColumns() {\n    for (const element of this.elementsForColumns) {\n      // if (element.isHidden || element.hasHiddenParent) {\n      //   continue;\n      // }\n\n      // repeatable elements don't have any physical columns, but we want to add a column that has the count of items\n      if (element.isRepeatableElement) {\n        this.addElementColumn(element, null, 'integer');\n      } else {\n        this.addElementColumn(element);\n      }\n\n      if (this.fullSchema && element.isAddressElement) {\n        this.addElementColumn(element, 'sub_thoroughfare');\n        this.addElementColumn(element, 'thoroughfare');\n        this.addElementColumn(element, 'suite');\n        this.addElementColumn(element, 'locality');\n        this.addElementColumn(element, 'sub_admin_area');\n        this.addElementColumn(element, 'admin_area');\n        this.addElementColumn(element, 'postal_code');\n        this.addElementColumn(element, 'country');\n      }\n\n      if (this.fullSchema && (element.isPhotoElement || element.isVideoElement || element.isAudioElement)) {\n        this.addElementColumn(element, 'captions', 'array');\n        this.addElementColumn(element, 'urls', 'array');\n      }\n\n      if (this.fullSchema && element.isSignatureElement) {\n        this.addElementColumn(element, 'timestamp');\n      }\n    }\n  }\n\n  findColumnByID(id) {\n    return this.columns.find(e => e.id === id);\n  }\n\n  columnForFieldKey(fieldKey, part) {\n    if (part) {\n      return this._columnsByKey[fieldKey + '_' + part];\n    }\n\n    return this._columnsByKey[fieldKey];\n  }\n\n  get geometryColumns() {\n    return this._columns.filter(c => c.isGeometry);\n  }\n\n  get columns() {\n    return this._columns;\n  }\n\n  get allElements() {\n    if (!this._allElements) {\n      this._allElements = this.container.flattenElements(false);\n    }\n    return this._allElements;\n  }\n\n  get elementsForColumns() {\n    if (!this._elementsForColumns) {\n      this._elementsForColumns = [];\n\n      const elements = this.allElements;\n\n      for (const element of elements) {\n        const skip = element.isSectionElement ||\n                     element.isLabelElement;\n\n        if (!skip) {\n          this._elementsForColumns.push(element);\n        }\n      }\n    }\n\n    return this._elementsForColumns;\n  }\n}\n"],"file":"form-field-schema.js"}